# Outlooké‚®ä»¶ç®¡ç†ç³»ç»Ÿ v2.0 å‡çº§æŒ‡å—

## ğŸ“‹ å‡çº§æ¦‚è¿°

æœ¬æ¬¡å‡çº§ï¼ˆv1.0 â†’ v2.0ï¼‰å¸¦æ¥ä»¥ä¸‹é‡å¤§æ”¹è¿›ï¼š

### ğŸ¯ æ–°åŠŸèƒ½
1. âœ… **JWTç®¡ç†å‘˜è®¤è¯** - å®‰å…¨çš„è®¿é—®æ§åˆ¶
2. âœ… **æ»šåŠ¨æ—¥å¿—ç³»ç»Ÿ** - 30å¤©æ—¥å¿—ä¿ç•™ï¼Œè‡ªåŠ¨æ¸…ç†
3. âœ… **SQLiteæ•°æ®åº“** - æ›¿ä»£JSONæ–‡ä»¶å­˜å‚¨
4. âœ… **ç®¡ç†é¢æ¿** - å¯è§†åŒ–ç®¡ç†æ‰€æœ‰æ•°æ®è¡¨
5. âœ… **ç³»ç»Ÿé…ç½®ç®¡ç†** - åŠ¨æ€é…ç½®ç³»ç»Ÿå‚æ•°

---

## ğŸš€ å¿«é€Ÿå‡çº§æ­¥éª¤

### 1. å®‰è£…æ–°ä¾èµ–

```bash
pip install -r requirements.txt
```

æ–°å¢ä¾èµ–ï¼š
- `python-jose[cryptography]` - JWTè®¤è¯
- `passlib[bcrypt]` - å¯†ç åŠ å¯†
- `python-multipart` - è¡¨å•æ•°æ®å¤„ç†

### 2. æ•°æ®è¿ç§»

è¿è¡Œè¿ç§»è„šæœ¬ï¼Œå°†ç°æœ‰ `accounts.json` æ•°æ®è¿ç§»åˆ°SQLiteæ•°æ®åº“ï¼š

```bash
python migrate.py
```

è¿ç§»è„šæœ¬ä¼šï¼š
- åˆ›å»ºSQLiteæ•°æ®åº“è¡¨ç»“æ„
- è¿ç§»æ‰€æœ‰è´¦æˆ·æ•°æ®
- åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
- åˆå§‹åŒ–ç³»ç»Ÿé…ç½®

**é»˜è®¤ç®¡ç†å‘˜å‡­æ®ï¼š**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123`
- **âš ï¸ è¯·é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç ï¼**

### 3. å¯åŠ¨åº”ç”¨

```bash
# ç›´æ¥å¯åŠ¨
python main.py

# æˆ–ä½¿ç”¨ uvicorn
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 4. é¦–æ¬¡ç™»å½•

1. è®¿é—®ç™»å½•é¡µé¢ï¼šhttp://localhost:8000/static/login.html
2. ä½¿ç”¨é»˜è®¤å‡­æ®ç™»å½•
3. ç«‹å³ä¿®æ”¹å¯†ç ï¼ˆåœ¨ç®¡ç†é¢æ¿æˆ–ä½¿ç”¨APIï¼‰

---

## ğŸ³ Docker å‡çº§

### æ›´æ–°é…ç½®

`docker-compose.yml` å·²æ›´æ–°ï¼Œæ–°å¢æ—¥å¿—å·æŒ‚è½½ï¼š

```yaml
volumes:
  - ./data.db:/app/data.db        # æ•°æ®åº“æ–‡ä»¶
  - ./logs:/app/logs              # æ—¥å¿—ç›®å½•
  - ./accounts.json:/app/accounts.json  # è¿ç§»ç”¨
```

### é‡æ–°æ„å»ºå’Œå¯åŠ¨

```bash
# åœæ­¢æ—§å®¹å™¨
docker-compose down

# é‡æ–°æ„å»ºé•œåƒ
docker-compose build

# å¯åŠ¨æ–°å®¹å™¨
docker-compose up -d
```

### åœ¨å®¹å™¨ä¸­è¿è¡Œè¿ç§»

```bash
# è¿›å…¥å®¹å™¨
docker exec -it outlook-email-api sh

# è¿è¡Œè¿ç§»è„šæœ¬
python migrate.py

# é€€å‡ºå®¹å™¨
exit
```

---

## ğŸ“Š æ–°åŠŸèƒ½ä½¿ç”¨æŒ‡å—

### 1. ç®¡ç†å‘˜ç™»å½•

è®¿é—®ï¼š`http://localhost:8000/static/login.html`

ç™»å½•åä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸»é¡µé¢ï¼Œæ‰€æœ‰APIè°ƒç”¨ä¼šè‡ªåŠ¨æºå¸¦JWT tokenã€‚

### 2. ç®¡ç†é¢æ¿

ç™»å½•åï¼Œåœ¨ä¸»é¡µé¢å·¦ä¾§èœå•å¯ä»¥æ‰¾åˆ°"ç®¡ç†é¢æ¿"é€‰é¡¹ã€‚

ç®¡ç†é¢æ¿åŠŸèƒ½ï¼š
- ğŸ“‹ æŸ¥çœ‹æ‰€æœ‰æ•°æ®è¡¨
- âœï¸ ç›´æ¥ç¼–è¾‘è¡¨æ•°æ®ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- âš™ï¸ ç®¡ç†ç³»ç»Ÿé…ç½®
- ğŸ‘¥ ç®¡ç†ç®¡ç†å‘˜è´¦æˆ·

### 3. APIè®¤è¯

æ‰€æœ‰APIç«¯ç‚¹ï¼ˆé™¤ç™»å½•æ¥å£å¤–ï¼‰ç°åœ¨éƒ½éœ€è¦JWTè®¤è¯ï¼š

```bash
# è·å–token
curl -X POST http://localhost:8000/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}'

# ä½¿ç”¨tokenè®¿é—®API
curl -X GET http://localhost:8000/accounts \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### 4. å¯†ç ç®¡ç†

**é€šè¿‡APIä¿®æ”¹å¯†ç ï¼š**

```bash
curl -X POST http://localhost:8000/auth/change-password \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"old_password": "admin123", "new_password": "new_secure_password"}'
```

### 5. æŸ¥çœ‹æ—¥å¿—

æ—¥å¿—æ–‡ä»¶ä½äº `logs/outlook_manager.log`

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f logs/outlook_manager.log

# æŸ¥çœ‹ç‰¹å®šæ—¥æœŸçš„æ—¥å¿—
ls logs/
# outlook_manager.log.2024-01-15
```

æ—¥å¿—ä¼šè‡ªåŠ¨æŒ‰å¤©è½®è½¬ï¼Œä¿ç•™30å¤©åè‡ªåŠ¨åˆ é™¤ã€‚

---

## ğŸ—‚ï¸ æ•°æ®åº“ç®¡ç†

### æŸ¥çœ‹æ•°æ®åº“

```bash
# å®‰è£… sqlite3ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
# Ubuntu/Debian: sudo apt install sqlite3
# macOS: è‡ªå¸¦

# æ‰“å¼€æ•°æ®åº“
sqlite3 data.db

# æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

# æŸ¥çœ‹è¡¨ç»“æ„
.schema accounts

# æŸ¥è¯¢æ•°æ®
SELECT * FROM accounts;

# é€€å‡º
.quit
```

### å¤‡ä»½æ•°æ®åº“

```bash
# å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
cp data.db data.db.backup

# æˆ–ä½¿ç”¨SQLiteå¯¼å‡º
sqlite3 data.db .dump > backup.sql
```

### æ¢å¤æ•°æ®åº“

```bash
# ä»å¤‡ä»½æ–‡ä»¶æ¢å¤
cp data.db.backup data.db

# æˆ–ä»SQLå¯¼å…¥
sqlite3 data.db < backup.sql
```

---

## ğŸ”§ é…ç½®ç®¡ç†

### ç³»ç»Ÿé…ç½®é¡¹

ç³»ç»Ÿé…ç½®å­˜å‚¨åœ¨ `system_config` è¡¨ä¸­ï¼Œå¯é€šè¿‡ç®¡ç†é¢æ¿æˆ–APIä¿®æ”¹ï¼š

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `IMAP_SERVER` | outlook.office365.com | IMAPæœåŠ¡å™¨åœ°å€ |
| `IMAP_PORT` | 993 | IMAPæœåŠ¡å™¨ç«¯å£ |
| `MAX_CONNECTIONS` | 5 | æ¯ä¸ªé‚®ç®±çš„æœ€å¤§è¿æ¥æ•° |
| `CONNECTION_TIMEOUT` | 30 | è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |
| `SOCKET_TIMEOUT` | 15 | Socketè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ |
| `CACHE_EXPIRE_TIME` | 60 | ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰ |
| `TOKEN_REFRESH_INTERVAL` | 3 | Tokenåˆ·æ–°é—´éš”ï¼ˆå¤©ï¼‰ |
| `LOG_RETENTION_DAYS` | 30 | æ—¥å¿—ä¿ç•™å¤©æ•° |

### é€šè¿‡APIæ›´æ–°é…ç½®

```bash
curl -X PUT http://localhost:8000/admin/config/MAX_CONNECTIONS \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"value": "10", "description": "æœ€å¤§è¿æ¥æ•°"}'
```

---

## â— æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è¿ç§»
- âœ… è¿ç§»æˆåŠŸåï¼Œå»ºè®®å¤‡ä»½ `accounts.json` ä¸º `accounts.json.backup`
- âœ… ç¡®è®¤æ‰€æœ‰æ•°æ®è¿ç§»æ­£ç¡®åï¼Œå¯ä»¥åˆ é™¤æ—§çš„JSONæ–‡ä»¶
- âš ï¸ ä¸è¦åœ¨è¿ç§»è¿‡ç¨‹ä¸­åŒæ—¶è¿è¡Œæ—§ç‰ˆå’Œæ–°ç‰ˆåº”ç”¨

### 2. å®‰å…¨æ€§
- ğŸ”’ ç«‹å³ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
- ğŸ”’ JWTå¯†é’¥é»˜è®¤æ˜¯éšæœºç”Ÿæˆçš„ï¼Œé‡å¯åä¼šæ”¹å˜ï¼ˆå¯é€šè¿‡ç¯å¢ƒå˜é‡å›ºå®šï¼‰
- ğŸ”’ ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨HTTPS

### 3. æ€§èƒ½
- ğŸ“ˆ SQLiteé€‚åˆä¸­å°è§„æ¨¡ä½¿ç”¨ï¼ˆ< 1000ä¸ªè´¦æˆ·ï¼‰
- ğŸ“ˆ å¤§è§„æ¨¡ä½¿ç”¨å»ºè®®è¿ç§»åˆ°PostgreSQLæˆ–MySQL
- ğŸ“ˆ æ—¥å¿—æ–‡ä»¶ä¼šå ç”¨ç£ç›˜ç©ºé—´ï¼Œæ³¨æ„ç›‘æ§

### 4. å…¼å®¹æ€§
- âš ï¸ æ‰€æœ‰APIè°ƒç”¨ç°åœ¨éƒ½éœ€è¦JWT token
- âš ï¸ å‰ç«¯åº”ç”¨éœ€è¦å¤„ç†ç™»å½•å’Œtokenåˆ·æ–°
- âš ï¸ æ—§ç‰ˆçš„ç›´æ¥æ–‡ä»¶è®¿é—®ä¸å†æœ‰æ•ˆ

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ— æ³•ç™»å½•

```bash
# é‡ç½®ç®¡ç†å‘˜å¯†ç 
python -c "
import database as db
import auth
db.init_database()
db.update_admin_password('admin', auth.hash_password('admin123'))
print('å¯†ç å·²é‡ç½®ä¸º: admin123')
"
```

### é—®é¢˜ï¼šè¿ç§»å¤±è´¥

```bash
# åˆ é™¤æ•°æ®åº“é‡æ–°è¿ç§»
rm data.db
python migrate.py
```

### é—®é¢˜ï¼šTokenå¤±æ•ˆ

- Tokenæœ‰æ•ˆæœŸä¸º24å°æ—¶
- æ¸…é™¤æµè§ˆå™¨ä¸­çš„ `auth_token`ï¼Œé‡æ–°ç™»å½•
- æ£€æŸ¥æœåŠ¡å™¨æ—¶é—´æ˜¯å¦æ­£ç¡®

### é—®é¢˜ï¼šæ—¥å¿—ä¸è®°å½•

```bash
# æ£€æŸ¥æ—¥å¿—ç›®å½•æƒé™
ls -la logs/
chmod 777 logs/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

---

## ğŸ“ è·å–å¸®åŠ©

- ğŸ“– æŸ¥çœ‹APIæ–‡æ¡£ï¼šhttp://localhost:8000/docs
- ğŸ› æŠ¥å‘Šé—®é¢˜ï¼šåˆ›å»º GitHub Issue
- ğŸ’¬ æŠ€æœ¯æ”¯æŒï¼šæŸ¥çœ‹é¡¹ç›®README

---

**å‡çº§å®Œæˆåï¼Œæ‚¨çš„ç³»ç»Ÿå°†æ‹¥æœ‰æ›´å¼ºå¤§çš„å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼** ğŸ‰

