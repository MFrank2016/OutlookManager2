# 📊 管理面板使用说明

## 一、访问管理面板

1. **启动应用**：
   ```bash
   python main.py
   ```

2. **登录系统**：
   - 访问：http://localhost:8001/static/login.html
   - 默认账号：`admin`
   - 默认密码：`admin123`
   - **重要**：首次登录后请立即修改密码！

3. **进入管理面板**：
   - 登录成功后，点击左侧侧边栏的 **⚙️ 管理面板** 菜单

## 二、管理面板功能

### 2.1 数据表管理

**功能列表**：
- 📊 查看所有数据库表（accounts、admins、system_config）
- 🔍 查看表的详细数据和记录数
- 🔎 搜索表数据（支持全字段搜索）
- 🗑️ 删除表记录
- ✏️ 编辑表记录（开发中）
- 🔄 刷新表数据

**使用步骤**：
1. 点击"数据表管理"标签
2. 选择要查看的表（accounts、admins、system_config）
3. 查看表数据，支持以下操作：
   - **搜索**：在搜索框输入关键词，实时过滤数据
   - **编辑**：点击"✏️ 编辑"按钮（功能开发中）
   - **删除**：点击"🗑️ 删除"按钮，确认后删除记录
   - **刷新**：点击"🔄 刷新"按钮重新加载数据
   - **返回**：点击"← 返回"按钮回到表列表

### 2.2 系统配置管理

**功能列表**：
- 📋 查看所有系统配置项
- ✏️ 修改配置值
- 📝 查看配置描述和更新时间

**配置项说明**：
- `imap_server`：IMAP服务器地址（如：outlook.office365.com）
- `imap_port`：IMAP端口号（默认：993）
- `imap_use_ssl`：是否使用SSL（true/false）
- `max_connections`：连接池最大连接数
- `cache_timeout`：缓存超时时间（秒）
- `token_refresh_interval`：Token刷新间隔（秒）

**使用步骤**：
1. 点击"系统配置"标签
2. 找到要修改的配置项
3. 点击"✏️ 编辑"按钮
4. 在弹出的对话框中输入新值
5. 确认后配置立即生效

## 三、API端点说明

管理面板使用以下API端点（需要JWT认证）：

### 数据表相关

```bash
# 获取表记录数
GET /admin/tables/{table_name}/count

# 获取表数据（支持分页和搜索）
GET /admin/tables/{table_name}?page=1&page_size=1000&search=关键词

# 删除表记录
DELETE /admin/tables/{table_name}/{record_id}
```

### 系统配置相关

```bash
# 获取所有配置
GET /admin/config

# 创建或更新配置
POST /admin/config
{
  "key": "config_key",
  "value": "config_value",
  "description": "配置说明"
}

# 删除配置
DELETE /admin/config/{key}
```

## 四、注意事项

⚠️ **重要提示**：

1. **管理员权限**：所有管理面板操作都需要管理员登录
2. **数据安全**：
   - 删除操作不可恢复，请谨慎操作
   - 密码字段在表中自动隐藏为 `********`
   - 建议定期备份数据库文件（data.db）

3. **性能考虑**：
   - 表数据一次最多加载1000条记录
   - 大表使用搜索功能过滤数据
   - 避免频繁刷新，按需加载

4. **浏览器兼容性**：
   - 推荐使用最新版 Chrome、Firefox、Edge
   - 需要启用 JavaScript 和 LocalStorage

## 五、常见问题

### Q1: 无法访问管理面板？
**A**: 检查是否已登录，JWT token是否有效（24小时过期）

### Q2: 删除操作失败？
**A**: 检查记录是否有外键约束，是否有足够的权限

### Q3: 配置修改后不生效？
**A**: 部分配置需要重启应用才能生效（如IMAP服务器设置）

### Q4: 表数据显示不完整？
**A**: 长文本字段自动截断到50字符，点击编辑可查看完整内容

## 六、快速测试

1. **测试数据表管理**：
   ```bash
   # 访问管理面板 > 数据表管理 > 点击 accounts 表
   # 查看所有邮箱账户
   ```

2. **测试配置管理**：
   ```bash
   # 访问管理面板 > 系统配置
   # 修改一个测试配置项，如 cache_timeout
   ```

3. **测试删除功能**：
   ```bash
   # 先创建一个测试账户
   # 在管理面板中找到该账户并删除
   ```

## 七、技术栈

- **前端**：HTML + CSS + JavaScript (原生)
- **后端**：FastAPI + SQLite3
- **认证**：JWT (JSON Web Tokens)
- **数据库**：SQLite3 (data.db)
- **日志**：Rolling file handler (30天保留)

---

📝 **更新日期**：2025-10-29  
🔖 **版本**：v2.0.0  
👨‍💻 **文档作者**：AI Assistant

