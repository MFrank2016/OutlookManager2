# é‚®ä»¶ç¼“å­˜æ”¹è¿› - å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

| é—®é¢˜ | å½±å“ | ä¼˜å…ˆçº§ |
|------|------|--------|
| SQLiteç¼“å­˜æ— è¿‡æœŸæœºåˆ¶ | å¯èƒ½è¿”å›è¿‡æœŸæ•°æ® | ğŸ”´ ç´§æ€¥ |
| ç¼ºå°‘å…³é”®ç´¢å¼• | æœç´¢å’Œè¿‡æ»¤æ…¢ | ğŸ”´ ç´§æ€¥ |
| æ— è‡ªåŠ¨æ¸…ç†æœºåˆ¶ | æ•°æ®åº“æ— é™å¢é•¿ | ğŸ”´ ç´§æ€¥ |
| ç¼ºå°‘å¤§å°é™åˆ¶ | å ç”¨è¿‡å¤šç£ç›˜ | ğŸŸ¡ é‡è¦ |
| æ— LRUç­–ç•¥ | ç¼“å­˜æ•ˆç‡ä½ | ğŸŸ¡ é‡è¦ |

## ğŸš€ å¿«é€Ÿå®æ–½ï¼ˆ1-2å‘¨ï¼‰

### 1. æ·»åŠ è¿‡æœŸæ—¶é—´å­—æ®µ

```sql
-- æ‰§è¡Œè¿ç§»
sqlite3 data.db

ALTER TABLE emails_cache ADD COLUMN expires_at TEXT;
ALTER TABLE emails_cache ADD COLUMN updated_at TEXT;
ALTER TABLE email_details_cache ADD COLUMN expires_at TEXT;
ALTER TABLE email_details_cache ADD COLUMN updated_at TEXT;

CREATE INDEX idx_emails_cache_expires ON emails_cache(expires_at);
CREATE INDEX idx_email_details_cache_expires ON email_details_cache(expires_at);

.quit
```

### 2. æ·»åŠ æ€§èƒ½ç´¢å¼•

```sql
sqlite3 data.db

CREATE INDEX idx_emails_cache_folder ON emails_cache(folder);
CREATE INDEX idx_emails_cache_from_email ON emails_cache(from_email);
CREATE INDEX idx_emails_cache_account_folder ON emails_cache(email_account, folder);

.quit
```

### 3. æ·»åŠ é…ç½®

```python
# config.py
SQLITE_CACHE_EXPIRE_TIME = 3600  # 1å°æ—¶
EMAIL_DETAILS_CACHE_EXPIRE_TIME = 7200  # 2å°æ—¶
MAX_CACHE_SIZE_MB = 500  # æœ€å¤§500MB
```

### 4. æ·»åŠ æ¸…ç†ä»»åŠ¡

```python
# requirements.txt
APScheduler==3.10.4

# main.py
from apscheduler.schedulers.background import BackgroundScheduler

scheduler = BackgroundScheduler()
scheduler.add_job(db.clean_expired_cache, 'interval', hours=1)
scheduler.start()
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

- âœ… ç¼“å­˜å‘½ä¸­ç‡: 60% â†’ 85% (+42%)
- âœ… é¦–æ¬¡åŠ è½½: 2-3ç§’ â†’ 0.3-0.5ç§’ (+80%)
- âœ… æœç´¢é€Ÿåº¦: 500-800ms â†’ 100-200ms (+75%)
- âœ… æ•°æ®åº“å¤§å°: æ— é™ â†’ <500MB (å—æ§)

## ğŸ” éªŒè¯æ–¹æ³•

```bash
# 1. æ£€æŸ¥ç´¢å¼•
sqlite3 data.db "SELECT name FROM sqlite_master WHERE type='index';"

# 2. æ£€æŸ¥å­—æ®µ
sqlite3 data.db "PRAGMA table_info(emails_cache);"

# 3. æ£€æŸ¥ç¼“å­˜å¤§å°
sqlite3 data.db "SELECT COUNT(*) FROM emails_cache;"
sqlite3 data.db "SELECT COUNT(*) FROM email_details_cache;"

# 4. æ£€æŸ¥è¿‡æœŸç¼“å­˜
sqlite3 data.db "SELECT COUNT(*) FROM emails_cache WHERE expires_at < datetime('now');"
```

## ğŸ“š å®Œæ•´æ–‡æ¡£

è¯¦è§: `docs/é‚®ä»¶ç¼“å­˜è®¾è®¡åˆ†æä¸æ”¹è¿›å»ºè®®.md`

---

**æ›´æ–°æ—¥æœŸ**: 2025-11-01
